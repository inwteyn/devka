<script type="text/javascript">  en4.core.runonce.add(function () {    var filter = '<?php echo $this->filter; ?>';    offers_manager.filter = filter;    offers_manager.my_offers_filter = '<?php echo $this->my_offers_filter; ?>';    offers_manager.changeStatusCouponUrl = '<?php  echo $this->url(array("action" => "change-status-coupon"), "offers_general")?>';    offers_manager.offersBrowseUrl = '<?php echo $this->url(array('action' => 'browse'), 'offers_general', true); ?>';    if (filter == 'mine' && offers_manager.my_offers_filter == 'upcoming') {      $$('.upcoming_button').addClass('active');      $$('.past_button').removeClass('active');    }    else if (filter == 'mine' && offers_manager.my_offers_filter == 'past') {      $$('.upcoming_button').removeClass('active');      $$('.past_button').addClass('active');    }  });</script><?php$this->headScript()  ->appendFile($this->layout()->staticBaseUrl . 'application/modules/Offers/externals/scripts/core.js');$i = 0;$pop = $this->GetPopularOffers();?><?php if ($this->filter != 'mine'): ?>  <?php if (count($this->paginator) > 0): ?>    <ul class="offers HeCubeView">      <?php foreach ($this->paginator as $offer): ?>        <?php $link_view = $this->url(array('action' => 'view', 'offer_id' => $offer->getIdentity()), 'offers_specific'); ?>        <li id="offer_id_<?php echo $offer->offer_id; ?>"            class="offer_item ">         <a href="<?php echo $offer->getHref()?>"><div  class="offer_photo"               style="background-image: url('<?php echo $offer->getPhotoUrl('thumb.profile') ?>');"></div></a>          <div class="offer_info">            <div class="offer_title">              <h3><?php echo $this->htmlLink($offer->getHref(), $this->string()->truncate($offer->getTitle(), 20)); ?></h3>            </div>          </div>          <div class="offer_options">            <?php if($offer->featured):?>            <div class="featured_offers_status">              <?php echo $this->translate('Featured')?>            </div>            <?php endif;?>            <?php            if(count($pop )>0) {              foreach ($pop as $popular) {                if ($popular['offer_id'] == $offer->getIdentity()) {                  ?>                  <div class="popular_offers_status">                    <?php echo $this->translate('Popular') ?>                  </div>                <?php                }              }            }            ?>            <div class="offer_discount">              <!--<label><?php /*echo $this->translate('OFFERS_offer_discount'); */?></label>-->              <span><?php echo $this->getOfferDiscount($offer);?></span></div>            <?php if(isset($offer->price_item) && !empty($offer->price_item)): ?>            <div class="item_price with_main_price" style="float: none;">                <span style="font-size: 9pt">                <span class="line_overline_price_parent" >                  <?php                  $temp =  explode('.',@$this->locale()->toCurrency((int)$offer->price_item, $this->currency));                  echo $temp[0]; ?>                  <span class="line_overline_price"></span>                </span> - <?php                  if($offer->getOfferType() == 'free'){                    if($offer->discount_type  == 'percent'){                      $discount_price_echo = $offer->price_item - (($offer->price_item / 100)* $offer->discount);                      $ttenp = explode('.',@$this->locale()->toCurrency((int)$discount_price_echo, $this->currency));                      echo $ttenp[0];                    }else{                      $temp = explode('.',@$this->locale()->toCurrency((int)$offer->price_item - $offer->discount, $this->currency));                      echo $temp[0];                    }                  }elseif($offer->getOfferType() == 'reward'){                    if($offer->discount_type  == 'percent'){                      $discount_price_echo = $offer->price_item - (($offer->price_item / 100)* $offer->discount);                      $temp =explode('.',@$this->locale()->toCurrency((int)$discount_price_echo, $this->currency));                      echo $temp[0];                    }else{                      $temp = explode('.',@$this->locale()->toCurrency((int)$offer->price_item - $offer->discount, $this->currency));                      echo $temp[0];                    }                  }else{                    $temp = explode('.',@$this->locale()->toCurrency((int)$offer->price_offer, $this->currency));                    echo $temp[0];                  }                  ?>              </span>            </div>            <?php endif;            ?>            <?php if($offer->type != 'paid'): ?>              <div class="offer_price" style="float: none;">                <?php echo $this->getOfferPrice($offer); ?>              </div>            <?php endif; ?>            <?php if (Engine_Api::_()->offers()->availableOffer($offer, true) != 'Unlimited'): ?>              <div class="offer_time_left">                <label>                  <?php echo $this->translate('OFFERS_offer_time_left'); ?></label>                <span>                  <?php echo Engine_Api::_()->offers()->availableOffer($offer, true); ?></span></div>            <?php //else: ?>              <?php if ($offer->coupons_count>0): ?>                <div class="offer_count"><label><?php echo $this->translate('OFFERS_offer_available'); ?></label>                  <span> <?php echo $this->translate('%s coupons', $offer->coupons_count); ?></span></div>              <?php endif; ?>            <?php endif; ?>          </div>          <div class="offer_view_button">            <button name="submit" class="btn_view_offer" onclick='javascript:Offers.view("<?php echo $link_view; ?>");'                    type="submit"><?php echo $this->translate('OFFERS_offer_view'); ?></button>          </div>        </li>      <?php endforeach; ?>    </ul>    <?php echo $this->paginationControl($this->paginator, null, array('pagination/index.tpl', 'offers')); ?>  <?php else : ?>    <div class="tip">      <span>        <?php if ($this->filter == 'upcoming') : ?>          <?php echo $this->translate('OFFERS_No upcoming items'); ?>        <?php else : ?>          <?php echo $this->translate('OFFERS_No past items'); ?>        <?php endif; ?>        <?php if ($this->isAllowedPost): ?>          <?php echo $this->translate('OFFERS_NOITEMS_CREATE'); ?>        <?php endif; ?>      </span>    </div>  <?php endif; ?><?php else: ?>  <?php if (count($this->paginator) > 0): ?>    <ul class="my_offers">      <div class="my_offers_navigation">        <ul>          <li><a href="<?php echo $this->url(array('my_offers_filter' => 'upcoming'), 'offers_mine'); ?>"                 class="menu_event_main upcoming_button active"><?php echo $this->translate('OFFERS_Upcoming') ?></a>          </li>          <li><a href="<?php echo $this->url(array('my_offers_filter' => 'past'), 'offers_mine'); ?>"                 class="menu_event_main past_button"><?php echo $this->translate('OFFERS_Past'); ?></a></li>        </ul>      </div>      <?php foreach ($this->paginator as $offer): ?>        <?php $link_view = $this->url(array('action' => 'view', 'offer_id' => $offer->getIdentity()), 'offers_specific'); ?>        <li id="offer_id_<?php echo $offer->offer_id; ?>" class="offer_item">          <div class="offer_photo <?php if ($this->my_offers_filter == 'past') echo 'past_photo'; ?>"               style="background-image: url('<?php echo $offer->getPhotoUrl('thumb.normal') ?>');">          </div>          <div class="right">            <div class="offer_info">              <div class="offer_title">                <h3><?php echo $this->htmlLink($offer->getHref(), $this->string()->truncate($offer->getTitle(), 20)); ?></h3>              </div>              <div class="offer_price">                <label><?php echo $this->translate('OFFERS_offer_price'); ?></label>                <span><?php echo $this->getOfferPrice($offer); ?></span>              </div>              <div class="offer_discount">               <!-- <label><?php /*echo $this->translate('OFFERS_offer_discount'); */?></label>-->                <span><?php echo $this->getOfferDiscount($offer); ?></span>              </div>              <div class="offer_count">                <label><?php echo $this->translate('OFFERS_offer_available'); ?></label>                <?php if (($offer->coupons_count > 0)): ?>                  <span><?php echo  $this->translate('%s coupons', $offer->coupons_count); ?></span>                <?php else: ?>                  <span class="offer_no_relevant"><?php echo $this->translate('OFFERS_offer_not_left'); ?></span>                <?php endif; ?>              </div>              <div class="offer_redeem">                <label><?php echo $this->translate('OFFERS_Redeem'); ?></label>                <span><?php echo Engine_Api::_()->offers()->timeInterval($offer); ?></span>              </div>              <?php if ($offer->page_id): ?>                <div class="offer_presented_by">                  <label><?php echo $this->translate('OFFERS_Presented by'); ?></label>                  <span><?php if ($offer->page_id > 0) echo $offer->page_title; ?></span>                </div>              <?php endif; ?>              <?php if ($offer->status == 'expired' && $this->my_offers_filter == 'past'): ?>                <div class="offer_status">                  <label><?php echo $this->translate('OFFERS_Status'); ?></label> <span                    class="expired"><?php echo $this->translate('OFFERS_Expired') ?></span>                </div>              <?php endif; ?>              <div class="offer_coupon_code">                <label><?php echo $this->translate('OFFERS_offer_coupon_code'); ?></label>                <span><?php echo $offer->getCouponCode(); ?></span>              </div>            </div>            <div class="offer_options">              <ul>                <?php if ($offer->status != 'expired' && $offer->status != 'used' && $this->my_offers_filter != 'past'): ?>                  <li><a                      href="<?php echo $this->url(array('action' => 'print', 'offer_id' => $offer->offer_id), 'offers_specific'); ?>"                      class="buttonlink print_offer"                      id="print_offer_<?php echo $offer->offer_id; ?>"><?php echo $this->translate('OFFERS_Print Offer'); ?></a>                  </li>                <?php endif; ?>                <?php if ($this->isSuggestEnabled && $this->my_offers_filter == 'upcoming'): ?>                  <li><?php echo $this->suggestItem($offer); ?></li>                <?php endif; ?>                <?php if ($this->my_offers_filter == 'upcoming' && $offer->active && $offer->status == 'active'): ?>                  <li>                    <a href="javascript:void(0);"                       onclick="offers_manager.changeStatusCoupon('<?php echo $offer->getIdentity(); ?>', this)"                       class="buttonlink mark_as_used" id="mark_as_used_<?php echo $offer->offer_id; ?>">                      <?php echo $this->translate('OFFERS_change_status_coupon', 'Used'); ?>                    </a>                  </li>                <?php endif; ?>                <?php if ($offer->status != 'expired' && $this->my_offers_filter != 'past'): ?>                  <li>                    <a                      href="<?php echo $this->url(array('action' => 'email', 'offer_id' => $offer->offer_id), 'offers_specific'); ?>"                      class="buttonlink smoothbox email_offer" id="email_<?php echo $offer->offer_id; ?>">                      <?php echo $this->translate('OFFERS_Email'); ?>                    </a>                  </li>                <?php endif; ?>              </ul>            </div>            <?php if ($offer->address != '' || $offer->city != '' || $offer->state != '' || $offer->country != '' || $offer->phone != '' || $offer->website != ''): ?>              <div class="offer_how_to_get">                <?php if ($offer->address != '' || $offer->city != '' || $offer->state != '' || $offer->country != ''): ?>                  <div                    class="offer_address"><?php echo $offer->address . ', ' . $offer->city . ', ' . $offer->state . ', ' . $offer->country; ?></div>                <?php endif; ?>                <?php if ($offer->phone != ''): ?>                  <div class="offer_contacts"><?php echo $offer->phone; ?></div>                <?php endif; ?>                <?php if ($offer->website != ''): ?>                  <div class="offer_website"><?php echo $offer->website; ?></div>                <?php endif; ?>              </div>            <?php endif; ?>            <button name="submit" class="btn_view_offer" onclick='javascript:Offers.view("<?php echo $link_view; ?>");'                    type="submit"><?php echo $this->translate('OFFERS_offer_view'); ?></button>          </div>        </li>      <?php endforeach; ?>    </ul>    <?php echo $this->paginationControl($this->paginator, null, array('pagination/index.tpl', 'offers')); ?>  <?php else : ?>    <div class="tip">      <span>        <?php echo $this->translate('OFFERS_No any accepted and active offers'); ?>        <?php if ($this->isAllowedPost): ?>          <?php echo $this->translate('OFFERS_NOITEMS_CREATE'); ?>        <?php endif; ?>      </span>      <div class="my_offers_navigation">        <ul>          <li><a href="<?php echo $this->url(array('my_offers_filter' => 'upcoming'), 'offers_mine'); ?>"                 class="menu_event_main upcoming_button active">Upcoming</a></li>          <li><a href="<?php echo $this->url(array('my_offers_filter' => 'past'), 'offers_mine'); ?>"                 class="menu_event_main past_button">Past</a></li>        </ul>      </div>    </div>  <?php endif; ?><?php endif; ?>